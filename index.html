<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover">
<title>Helix v48.6</title>
<link rel="manifest" href="manifest.json">
<style>
  body { background: #000; color: #fff; font-family: -apple-system, sans-serif; height: 100dvh; margin: 0; display: flex; flex-direction: column; overflow: hidden; }
  #scene { height: 25%; min-height: 140px; display: flex; justify-content: center; align-items: center; background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%); border-bottom: 1px solid #333; position: relative; }
  #core { width: 90px; height: 90px; background: radial-gradient(circle at 30% 30%, #fff, #0ff, #001); border-radius: 50%; box-shadow: 0 0 30px cyan; display: flex; justify-content: center; align-items: center; transition: 0.3s; z-index: 2; animation: float 6s ease-in-out infinite; }
  #core span { font-size: 10px; font-weight: 900; letter-spacing: 1px; color: rgba(0,0,0,0.6); font-family: monospace; pointer-events: none; }
  #core.listening { background: radial-gradient(circle at 30% 30%, #fff, #5f5, #010) !important; box-shadow: 0 0 60px lime !important; transform: scale(1.1); }
  #core.thinking { background: radial-gradient(circle at 30% 30%, #fff, #fb0, #420) !important; box-shadow: 0 0 50px orange !important; animation: pulseFast 0.5s alternate infinite !important; }
  @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
  @keyframes pulseFast { 0% { transform: scale(0.95); opacity: 0.8; } 100% { transform: scale(1.0); opacity: 1; } }
  #ui-layer { flex: 1; display: flex; flex-direction: column; padding: 10px; background: #0a0a0a; gap: 10px; overflow: hidden; position: relative; }
  #header-row { display: flex; justify-content: space-between; align-items: center; min-height: 30px; }
  #model-badge { background: #112; color: #aaf; border: 1px solid #336; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: bold; font-family: monospace; }
  #console { flex-grow: 1; overflow-y: auto; padding: 10px; border: 1px solid #222; border-radius: 8px; background: #000; display: flex; flex-direction: column; gap: 10px; }
  .msg { padding: 10px; border-radius: 8px; font-size: 15px; max-width: 90%; line-height: 1.4; word-wrap: break-word; }
  .user { align-self: flex-end; background: #222; color: #fff; }
  .ai { align-self: flex-start; color: #ccc; border: 1px solid #333; width: 100%; box-sizing: border-box; }
  #settings-panel { display: none; position: absolute; inset: 0; background: #000; z-index: 9999; flex-direction: column; align-items: center; padding: 30px; box-sizing: border-box; overflow-y: auto; }
  #settings-panel.active { display: flex !important; }
  .setting-label { color:#888; font-size:12px; margin-top:15px; width:100%; font-weight:bold; text-align: left; }
  .key-input { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #444; background: #111; color: white; margin-bottom: 10px; font-family: monospace; }
  #input-row { display: flex; gap: 8px; align-items: center; margin-top: auto; padding: 10px; }
  #txt-input { flex-grow: 1; padding: 12px; border-radius: 12px; border: 1px solid #333; background: #111; color: white; font-size: 16px; outline: none; }
  .action-btn { background: #222; color: #aaa; border: 1px solid #333; border-radius: 12px; width: 48px; height: 48px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; }
  #mic-btn.active { background: #060; color: #fff; border-color: lime; box-shadow: 0 0 15px #060; }
</style>
</head>
<body>

<div id="settings-panel">
    <h2 style="color:cyan; font-family:monospace;">HELIX CONFIG</h2>
    <div class="setting-label">Active Model</div>
    <select id="model-select" class="key-input">
        <option value="llama-3.3-70b-versatile">Groq: Llama 3.3</option>
        <option value="gemini-2.5-flash">Gemini 2.5 Flash</option>
    </select>
    <div class="setting-label">Groq API Key (gsk_...)</div>
    <input type="text" id="groq-key-input" class="key-input" placeholder="Paste Groq Key">
    <div class="setting-label">Google API Key (AIza...)</div>
    <input type="text" id="google-key-input" class="key-input" placeholder="Paste Gemini Key">
    <button style="width:100%; padding:20px; background:cyan; border-radius:10px; font-weight:bold; color:black;" onclick="saveSettings()">SAVE & REFRESH</button>
</div>

<div id="scene"><div id="core"><span id="orb-text">HELIX</span></div></div>

<div id="ui-layer">
  <div id="header-row">
    <div id="model-badge">READY</div>
    <button class="action-btn" style="width:auto; padding:0 15px; font-size:12px;" onclick="toggleSettings()">‚öô SETTINGS</button>
  </div>
  <div id="console"></div>
  <div id="input-row">
      <input id="txt-input" placeholder="Message..." onkeydown="if(event.key==='Enter') sendText()">
      <button id="mic-btn" class="action-btn" onclick="handleMicClick()">üé§</button>
      <button class="action-btn" onclick="sendText()" style="color:cyan;">‚ñ∂</button>
  </div>
</div>

<script>
let googleKey = localStorage.getItem('helix_google_key_v47') || "";
let groqKey = localStorage.getItem('helix_groq_key_v47') || "";
let currentModel = localStorage.getItem('helix_model_v47') || "llama-3.3-70b-versatile";
let micEnabled = false;
let recognition = null;

// Initialize Speech Recognition
if ('webkitSpeechRecognition' in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.onstart = () => { updateOrb('listening', 'LISTENING'); document.getElementById('mic-btn').classList.add('active'); };
    recognition.onend = () => { micEnabled = false; document.getElementById('mic-btn').classList.remove('active'); updateOrb('', 'HELIX'); };
    recognition.onresult = (e) => {
        document.getElementById('txt-input').value = e.results[0][0].transcript;
        sendText();
    };
}

window.onload = () => {
    updateBadge();
    if (!googleKey && !groqKey) toggleSettings();
};

function toggleSettings() { 
    document.getElementById('settings-panel').classList.toggle('active');
    document.getElementById('google-key-input').value = googleKey;
    document.getElementById('groq-key-input').value = groqKey;
}

function saveSettings() {
    localStorage.setItem('helix_google_key_v47', document.getElementById('google-key-input').value.trim());
    localStorage.setItem('helix_groq_key_v47', document.getElementById('groq-key-input').value.trim());
    localStorage.setItem('helix_model_v47', document.getElementById('model-select').value);
    location.reload();
}

function updateBadge() { document.getElementById('model-badge').innerText = currentModel.toUpperCase(); }

function handleMicClick() {
    if (!recognition) return alert("Mic not supported.");
    if (!micEnabled) { micEnabled = true; recognition.start(); } 
    else { micEnabled = false; recognition.stop(); }
}

async function sendText() {
    const input = document.getElementById('txt-input'); const t = input.value.trim();
    if (!t) return;

    const isGroq = currentModel.includes('llama');
    const activeKey = isGroq ? groqKey : googleKey;
    if (!activeKey) return toggleSettings();

    input.value = ""; addMessage('user', t); updateOrb('thinking', 'CONNECTING...');

    try {
        let response;
        if (isGroq) {
            response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${activeKey}`, 'Content-Type': 'application/json' },
                body: JSON.stringify({ model: currentModel, messages: [{ role: 'user', content: t }] })
            });
        } else {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${currentModel}:generateContent?key=${activeKey}`;
            response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ role: 'user', parts: [{ text: t }] }] })
            });
        }

        const data = await response.json();
        const aiText = isGroq ? data.choices[0].message.content : data.candidates[0].content.parts[0].text;

        addMessage('ai', aiText);
        updateOrb('', 'HELIX');
        window.speechSynthesis.speak(new SpeechSynthesisUtterance(aiText.slice(0, 500)));
    } catch (e) { addMessage('system', "‚ùå " + e.message); updateOrb('', 'ERROR'); }
}

function updateOrb(cls, txt) { document.getElementById('core').className = cls; document.getElementById('orb-text').innerText = txt; }
function addMessage(role, text) {
    const consoleDiv = document.getElementById('console'); const msg = document.createElement('div');
    msg.className = 'msg ' + role; msg.innerText = text;
    consoleDiv.appendChild(msg); consoleDiv.scrollTop = consoleDiv.scrollHeight;
}

if ('serviceWorker' in navigator) { navigator.serviceWorker.register('./sw.js'); }
</script>
</body>
</html>